# Компонентная архитектура

<!-- Состав и взаимосвязи компонентов системы между собой и внешними системами с указанием протоколов, ключевые технологии, используемые для реализации компонентов.
Диаграмма контейнеров C4 и текстовое описание.
-->

## Компонентная диаграмма

```plantuml
@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

AddElementTag("microService", $shape=EightSidedShape(), $bgColor="CornflowerBlue", $fontColor="white", $legendText="microservice")
AddElementTag("storage", $shape=RoundedBoxShape(), $bgColor="lightSkyBlue", $fontColor="white")

Person(user, "Пользователь")

System_Ext(web_site, "Клиентский веб-сайт", "HTML, CSS, TypeScript, React", "Веб-интерфейс")

System_Boundary(social_network_site, "Социальная сеть") {
   Container(auth_service, "Сервис аутентификации", "C++", "Сервис управления доступа пользователя к сети", $tags = "microService")
   Container(user_service, "Сервис пользователей", "C++", "Сервис поиска пользователей", $tags = "microService")
   Container(blog_service, "Сервис стены", "C++", "Сервис просмотра и управления записями стен", $tags = "microService")
   Container(messanger_service, "Сервис мессенджера", "C++", "Сервис управления чатами", $tags = "microService")
   ContainerDb(db, "База данных", "MySQL", "Хранение данных о пользователях, чатах и стенах", $tags = "storage")
}

Rel(user, web_site, "Регистрация, поиск других пользователей, добавление записи на стену, просмотр стен, чат с другими пользователями")

Rel(web_site, auth_service, "Аутентификация, регистрация, авторизация", "localhost/auth")
Rel(auth_service, db, "INSERT/SELECT/UPDATE", "SQL")

Rel(web_site, user_service, "Поиск пользователей", "localhost/user")
Rel(user_service, db, "SELECT", "SQL")

Rel(web_site, blog_service, "Работа со стеной", "localhost/blog")
Rel(blog_service, db, "INSERT/SELECT", "SQL")
Rel(blog_service, auth_service, "Проверка доступа", "localhost/auth")

Rel(web_site, messanger_service, "Работа с чатами", "localhost/messanger")
Rel(messanger_service, db, "INSERT/SELECT/UPDATE", "SQL")
Rel(messanger_service, auth_service, "Проверка доступа", "localhost/auth")

@enduml
```

## Список компонентов

### Сервис аутентификации

**EXTERNAL API**:

- Регистрация + авторизация
  - Входные параметры: логин, пароль, имя, фамилия, email, обращение (г-н/г-жа)
  - Выходные параметры: токен
- Аутентификация + авторизация
  - Входные параметры: логин, пароль
  - Выходные параметры: токен

**INTERNAL API**:

- Получение идентификатора пользователя:
  - Входные параметры: токен
  - Выходные параметры: идентификатор пользователя

### Сервис пользователей

**EXTERNAL API**:

- Получение пользователя по идентификатору
  - Входные параметры: идентификатор пользователя
  - Выходные параметры: идентификатор, логин, имя, фамилия, email, обращение (г-н/г-жа)
- Получение пользователя по логину
  - Входные параметры: логин пользователя
  - Выходные параметры: идентификатор, логин, имя, фамилия, email, обращение (г-н/г-жа)
- Поиск пользователя по маске имени и фамилии
  - Входные параметры: маска имени, маска фамилии
  - Выходные параметры: список пользователей, (идентификатор, логин, имя, фамилия, email, обращение (г-н/г-жа))

### Сервис стены

**EXTERNAL API**:

- Добавление записи на свою стену
  - Входные параметры: токен, заголовок, контент
  - Выходные параметры: идентификатор записи
- Получение своей стены
  - Входные параметры: токен
  - Выходные параметры: список записей (идентификатор, заголовок, контент, автор, дата публикации, лайки, дизлайки)
- Получение стены пользователя
  - Входные параметры: идентификатор пользователя
  - Выходные параметры: список записей (идентификатор, заголовок, контент, автор, дата публикации, лайки, дизлайки)

### Сервис мессенджера

**EXTERNAL API**:

- Создание чата
  - Входные параметры: токен, идентификатор собеседника
  - Выходные параметры: идентификатор чата
- Получение списка чатов
  - Входные параметры: токен
  - Выходные параметры: список идентификаторов чатов
- Получение чата
  - Входнае параметры: токен, идентификатор чата
  - Выходные парамтеры: идентификатор чата, сообщение, время отправки, признак прочтения собеседником
- Отправка сообщения в чате
  - Входные параметры: токен, идентификатор чата, сообщение
  - Выходные параметры: время отправки

**INTERNAL API**:

- Проверка доступа к чату
  - Входные параметры: токен, идентификатор чата
  - Выходные параметры: признак наличия доступа к чату
